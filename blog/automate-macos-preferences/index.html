<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <base href=/ > <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <meta content="ᓚᘏᗢ zzz...｡oＯ" property=og:description> <meta content=website property=og:type> <meta content=icon.jpg property=og:image> <meta content=icon.jpg name=twitter:image> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{slug:"automate-macos-preferences",title:"Automate all of MacOS configuration with Defaults&PlistBuddy, AppleScript and pmset",pubdate:"2020-03-09",html:"\u003Cul\u003E\n\u003Cli\u003EI wrote similar things \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fryuta69\u002Fdotfiles\u002Fissues\u002F5\"\u003Ehere\u003C\u002Fa\u003E in Japanese.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EWhen I cleaning \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fryuta69\u002Fdotfiles\"\u003Edotfiles\u003C\u002Fa\u003E, I thought I could automate all macos configuration as well such as not only defaults simple command but also Dock applications. Then, I achieve that so I wrote it down here.\u003C\u002Fp\u003E\n\u003Ch2 id=\"defaults\"\u003Edefaults\u003C\u002Fh2\u003E\n\u003Cp\u003EIf you develop with macos, you might have seen defaults command at least onse. The command below shows an configurations not to generate DS_STORE the Finder display setting files on Shared directory or USB.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Edefaults write com.apple.desktopservices DSDontWriteUSBStores -bool true\ndefaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003Edefaluts command is doing the reference, add, update, and delete on Mac system preferences like below.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Edefaults order[read(reference)\u002Fwrite(add\u002Fupdate)\u002Fdelete(delete)] domain[Mac configuration items array. I wrote lists below] The valid setting items on domain[I wrote lists below] value[-Type Value] \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EIf you like to show all the list of domain, you could type like this.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Edefaults domains | sed &#39;s\u002F \u002F\\n\u002Fg&#39;\n# alternative\nls ~\u002FLibrary\u002FPreferences | sed &#39;s\u002F.plist$\u002F\u002Fg&#39;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EAs you see the second command, plist files under ~\u002FLibrary\u002FPreferences are the configuration files. They set those files in each user folders. Sometimes you have directory such as ByHost, and it controlos Trackpad or something relate to Hardware, you need to change the command like \u003Ccode\u003Edefaults -currentHost write\u003C\u002Fcode\u003E. Some exceptions exist but this is the standard.\u003C\u002Fp\u003E\n\u003Ch3 id=\"check-what-configurations-are-assigned-to-plist\"\u003Echeck what configurations are assigned to plist\u003C\u002Fh3\u003E\n\u003Cp\u003EThis is the hardest things on this way. Apple never opened the document about it, we need to find out by ourselves. There a site called defaults-write.com opens the list, however, they are too old and not fine with mojaves or latter. It doesn&#39;t list by category so hard to check, anyway.\u003C\u002Fp\u003E\n\u003Cp\u003EThen I searched a hell and found out this repository.\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftech-otaku\u002Fmacos-config-mojave\u002Fblob\u002Fmaster\u002Fmacos-config.sh\"\u003Ehttps:\u002F\u002Fgithub.com\u002Ftech-otaku\u002Fmacos-config-mojave\u002Fblob\u002Fmaster\u002Fmacos-config.sh\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThis was life-changing. I felt like I found the treasure and really influenced by this. I appreciate this that I have started everything from this repository. Although this repository doesn&#39;t give us a all informations such as Trackpad, this helps a lot to start by myself from here.\u003C\u002Fp\u003E\n\u003Cp\u003EI need to search by myself so I choose this way. Changing some system preferences and search diff like this.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003E# rg is ripgrep, you can replace it with grep.\nalias -G TA=&#39;&gt; ~\u002Fwork\u002Ftemp\u002Fa.log&#39;\nalias -G TB=&#39;&gt; ~\u002Fwork\u002Ftemp\u002Fb.log&#39;\nalias dflg=&#39;diff ~\u002Fwork\u002Ftemp\u002Fa.log ~\u002Fwork\u002Ftemp\u002Fb.log&#39;\nls *.plist | defaults read -TA\nls *.plist | defaults read -TB\nDPNT=dflg\n\nls | xargs -I % sh -c &#39;echo % &amp;&amp; defaults read %&#39; | rg &#39;${DPNT}|plist&#39;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EIt&#39;s stable and the finest way, I guess.\u003C\u002Fp\u003E\n\u003Ch2 id=\"3-configurations-which-cant-be-done-by-defaults\"\u003E3 configurations which can&#39;t be done by defaults\u003C\u002Fh2\u003E\n\u003Cp\u003EFor example, Energy Saver is not referenced and assign inside plist. These changes are set inside sfl2 which is binary files and can&#39;t be controlled. Also, Applications in Dock are not controllable because they are deeply nested dict. \u003C\u002Fp\u003E\n\u003Ch3 id=\"pmset\"\u003Epmset\u003C\u002Fh3\u003E\n\u003Cp\u003EEnergy Saver can be controlled by pmset. It&#39;s a wrapper of macos configurations and compile it to sfl2.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Epmset -c displaysleep 3\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3 id=\"plistbuddy\"\u003EPlistBuddy\u003C\u002Fh3\u003E\n\u003Cp\u003EAlso defaults can&#39;t access deeper than 1 depth nest, while PlistBuddy can control any type of plist files.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003E\u002Fusr\u002Flibexec\u002FPlistBuddy -c &quot;Set :DesktopViewSettings:IconViewSettings:textSize 12&quot; ~\u002FLibrary\u002FPreferences\u002Fcom.apple.finder.plist\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EIn this way, you can controll any structures like comibined with bash. You can grep to findout, or calculate the length of array, and for-index to add array with Plist.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fryuta69\u002Fdotfiles\u002Fblob\u002Fmaster\u002Fsystem\u002Flib\u002Fdockitem.zsh\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fryuta69\u002Fdotfiles\u002Fblob\u002Fmaster\u002Fsystem\u002Flib\u002Fdockitem.zsh\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Ch2 id=\"applescript-to-set-with-gui-and-impossible-items-on-terminal\"\u003EAppleScript to set with GUI and impossible items on terminal\u003C\u002Fh2\u003E\n\u003Cp\u003EThis is the hardest thing. I had written a \u003Ca href=\"https:\u002F\u002Fqiita.com\u002Fryuta69\u002Fitems\u002Fc84501993635c72540a7\"\u003ESelenium article\u003C\u002Fa\u003E before, beside it is similar as Automation of GUI scripting in MacOS.\u003C\u002Fp\u003E\n\u003Cp\u003ESince you created the script, you can build an app with Automator, but it kind of not my goal to automate with CUI, so I skipped. They all will work with osascript.\u003C\u002Fp\u003E\n\u003Ch3 id=\"lets-try-just-open-system-preferences\"\u003Elet&#39;s try just open system preferences\u003C\u002Fh3\u003E\n\u003Cpre\u003E\u003Ccode\u003Etell application &quot;System Preferences&quot;\n    activate\nend tell\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EPut this in Script Editor in default MacOS editor. You can name as test.applescript and exec as osascript, but it doesn&#39;t stdout data. You can shell command inside to print out, but it&#39;s allowed to exec shell command once in the script. (I didn&#39;t know about this )\u003C\u002Fp\u003E\n\u003Cp\u003ERun it, and you&#39;ll be sure you are seeing System Preferences panel. You can command any Applications to boost with Applescript. Let&#39;s see General Preferences next.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Etell application &quot;System Preferences&quot;\n    activate\n  reveal pane id &quot;com.apple.preference.general&quot;\nend tell\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EPane means a series of root System Preferenes. It&#39;s assined with domain as you look at its name. I will list all domains later, now let&#39;s go next step to control them.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Etell application &quot;System Preferences&quot;\n    activate\n    reveal pane id &quot;com.apple.preference.general&quot;\nend tell\ntell application &quot;System Events&quot;\n    tell application process &quot;System Preferences&quot;\n        repeat while not (window 1 exists)\n        end repeat\n        tell window &quot;General&quot;\n            tell pop up button 3\n                delay 1\n                click\n            end tell\n        end tell\n    end tell\nend tell\nquit application &quot;System Preferences&quot;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EDid you get the menu of default browser? A \u003Ccode\u003ESystem Events\u003C\u002Fcode\u003E is an integrated function of Applescript which could interactive control such as click or keytype on Activated elements.\u003C\u002Fp\u003E\n\u003Ch3 id=\"to-list-all-the-elements-on-applescript\"\u003Eto list all the elements on applescript\u003C\u002Fh3\u003E\n\u003Cp\u003EIt&#39;s life changing, and this is what I like to tell the most in this article.\u003C\u002Fp\u003E\n\u003Cp\u003Epane\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Etell application &quot;System Preferences&quot;\n    name of panes\nend tell\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003Eanchor\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Etell application &quot;System Preferences&quot;\n  reveal pane id &quot;com.apple.preference.general&quot;\n  get name of every anchor\nend tell\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003Ethe items in active pane\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Etell application &quot;System Preferences&quot;\n    activate\n    reveal pane id &quot;com.apple.preference.general&quot;\nend tell\ntell application &quot;System Events&quot;\n    tell application process &quot;System Preferences&quot;\n        repeat while not (window 1 exists)\n        end repeat\n        tell window &quot;General&quot;\n            every UI element\n        end tell\n    end tell\nend tell\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3 id=\"lets-make-some-scripts\"\u003Elet&#39;s make some scripts\u003C\u002Fh3\u003E\n\u003Cp\u003EYou could choose default browser, and input sources with this.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fryuta69\u002Fdotfiles\u002Ftree\u002Fmaster\u002Fsystem\u002Flib\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fryuta69\u002Fdotfiles\u002Ftree\u002Fmaster\u002Fsystem\u002Flib\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EGUI settings and third party applications are now able to automate, I now finally can say I automate everything on MacOS.\u003C\u002Fp\u003E\n\u003Ch2 id=\"summary\"\u003Esummary\u003C\u002Fh2\u003E\n\u003Cp\u003EI&#39;m now confident with this script. I searched every other&#39;s script allday and everyday, and enhance myown for two month.\u003C\u002Fp\u003E\n\u003Cp\u003ENow I can use script editor, and select domains to search with it, but at first time there is no document, so I was struggling with a few informations and about core settings which is really hard to find. But those times are kind of fun and I really got enthusiatic about it.\u003C\u002Fp\u003E\n\u003Cp\u003EAfter all, I found myself really is a kind of person who is motivated with \u003Cstrong\u003Eeffective production\u003C\u002Fstrong\u003E. I used to speedrun gamers, and that time is like I didn&#39;t sleep, eat or talk with anyone. I got really absorbed in it and make script with it and find a bug to make breakthrough.....all for making time short, not dependence on people(make rule and reproductive), and beautiful to be proud. Now, I&#39;m programmer and doing kind of similar thing.\u003C\u002Fp\u003E\n\u003Cp\u003EIt&#39;s like studying others deeply, forget anything but itself, not sleeping nore eating, think how to appeal myself and beautiful, and make it reproductive and limit of effective to say this is perfect.\u003C\u002Fp\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');var s=document.createElement("script");try{new Function("if(0)import('')")();s.src="/client/client.970b8a7b.js";s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main","/client/client.970b8a7b.js")}document.head.appendChild(s)</script> <link href=client/client-d06356dd.css rel=stylesheet> <title>Automate all of MacOS configuration with Defaults&PlistBuddy, AppleScript and pmset</title><meta content="Automate all of MacOS configuration with Defaults&PlistBuddy, AppleScript and pmset" property=og:title data-svelte=svelte-19wcsm0> <link href=/client/client.970b8a7b.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-d06356dd.css rel=preload as=style><link href=/client/[slug].2a6f2f8d.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials></head> <body> <div id=sapper> <header><a href=/ rel=prefetch>ulwlu</a> <p>ᓚᘏᗢ Just personal blog.</header> <main> <div class=title><h1>Automate all of MacOS configuration with Defaults&PlistBuddy, AppleScript and pmset</h1></div> <div class=content><ul> <li>I wrote similar things <a href=https://github.com/ryuta69/dotfiles/issues/5>here</a> in Japanese.</li> </ul> <p>When I cleaning <a href=https://github.com/ryuta69/dotfiles>dotfiles</a>, I thought I could automate all macos configuration as well such as not only defaults simple command but also Dock applications. Then, I achieve that so I wrote it down here.</p> <h2 id=defaults>defaults</h2> <p>If you develop with macos, you might have seen defaults command at least onse. The command below shows an configurations not to generate DS_STORE the Finder display setting files on Shared directory or USB.</p> <pre><code>defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true</code></pre> <p>defaluts command is doing the reference, add, update, and delete on Mac system preferences like below.</p> <pre><code>defaults order[read(reference)/write(add/update)/delete(delete)] domain[Mac configuration items array. I wrote lists below] The valid setting items on domain[I wrote lists below] value[-Type Value] </code></pre> <p>If you like to show all the list of domain, you could type like this.</p> <pre><code>defaults domains | sed 's/ /\n/g'
# alternative
ls ~/Library/Preferences | sed 's/.plist$//g'</code></pre> <p>As you see the second command, plist files under ~/Library/Preferences are the configuration files. They set those files in each user folders. Sometimes you have directory such as ByHost, and it controlos Trackpad or something relate to Hardware, you need to change the command like <code>defaults -currentHost write</code>. Some exceptions exist but this is the standard.</p> <h3 id=check-what-configurations-are-assigned-to-plist>check what configurations are assigned to plist</h3> <p>This is the hardest things on this way. Apple never opened the document about it, we need to find out by ourselves. There a site called defaults-write.com opens the list, however, they are too old and not fine with mojaves or latter. It doesn't list by category so hard to check, anyway.</p> <p>Then I searched a hell and found out this repository. <a href=https://github.com/tech-otaku/macos-config-mojave/blob/master/macos-config.sh>https://github.com/tech-otaku/macos-config-mojave/blob/master/macos-config.sh</a></p> <p>This was life-changing. I felt like I found the treasure and really influenced by this. I appreciate this that I have started everything from this repository. Although this repository doesn't give us a all informations such as Trackpad, this helps a lot to start by myself from here.</p> <p>I need to search by myself so I choose this way. Changing some system preferences and search diff like this.</p> <pre><code># rg is ripgrep, you can replace it with grep.
alias -G TA='> ~/work/temp/a.log'
alias -G TB='> ~/work/temp/b.log'
alias dflg='diff ~/work/temp/a.log ~/work/temp/b.log'
ls *.plist | defaults read -TA
ls *.plist | defaults read -TB
DPNT=dflg

ls | xargs -I % sh -c 'echo % && defaults read %' | rg '${DPNT}|plist'</code></pre> <p>It's stable and the finest way, I guess.</p> <h2 id=3-configurations-which-cant-be-done-by-defaults>3 configurations which can't be done by defaults</h2> <p>For example, Energy Saver is not referenced and assign inside plist. These changes are set inside sfl2 which is binary files and can't be controlled. Also, Applications in Dock are not controllable because they are deeply nested dict. </p> <h3 id=pmset>pmset</h3> <p>Energy Saver can be controlled by pmset. It's a wrapper of macos configurations and compile it to sfl2.</p> <pre><code>pmset -c displaysleep 3</code></pre> <h3 id=plistbuddy>PlistBuddy</h3> <p>Also defaults can't access deeper than 1 depth nest, while PlistBuddy can control any type of plist files.</p> <pre><code>/usr/libexec/PlistBuddy -c "Set :DesktopViewSettings:IconViewSettings:textSize 12" ~/Library/Preferences/com.apple.finder.plist</code></pre> <p>In this way, you can controll any structures like comibined with bash. You can grep to findout, or calculate the length of array, and for-index to add array with Plist.</p> <p><a href=https://github.com/ryuta69/dotfiles/blob/master/system/lib/dockitem.zsh>https://github.com/ryuta69/dotfiles/blob/master/system/lib/dockitem.zsh</a></p> <h2 id=applescript-to-set-with-gui-and-impossible-items-on-terminal>AppleScript to set with GUI and impossible items on terminal</h2> <p>This is the hardest thing. I had written a <a href=https://qiita.com/ryuta69/items/c84501993635c72540a7>Selenium article</a> before, beside it is similar as Automation of GUI scripting in MacOS.</p> <p>Since you created the script, you can build an app with Automator, but it kind of not my goal to automate with CUI, so I skipped. They all will work with osascript.</p> <h3 id=lets-try-just-open-system-preferences>let's try just open system preferences</h3> <pre><code>tell application "System Preferences"
    activate
end tell</code></pre> <p>Put this in Script Editor in default MacOS editor. You can name as test.applescript and exec as osascript, but it doesn't stdout data. You can shell command inside to print out, but it's allowed to exec shell command once in the script. (I didn't know about this )</p> <p>Run it, and you'll be sure you are seeing System Preferences panel. You can command any Applications to boost with Applescript. Let's see General Preferences next.</p> <pre><code>tell application "System Preferences"
    activate
  reveal pane id "com.apple.preference.general"
end tell</code></pre> <p>Pane means a series of root System Preferenes. It's assined with domain as you look at its name. I will list all domains later, now let's go next step to control them.</p> <pre><code>tell application "System Preferences"
    activate
    reveal pane id "com.apple.preference.general"
end tell
tell application "System Events"
    tell application process "System Preferences"
        repeat while not (window 1 exists)
        end repeat
        tell window "General"
            tell pop up button 3
                delay 1
                click
            end tell
        end tell
    end tell
end tell
quit application "System Preferences"</code></pre> <p>Did you get the menu of default browser? A <code>System Events</code> is an integrated function of Applescript which could interactive control such as click or keytype on Activated elements.</p> <h3 id=to-list-all-the-elements-on-applescript>to list all the elements on applescript</h3> <p>It's life changing, and this is what I like to tell the most in this article.</p> <p>pane</p> <pre><code>tell application "System Preferences"
    name of panes
end tell</code></pre> <p>anchor</p> <pre><code>tell application "System Preferences"
  reveal pane id "com.apple.preference.general"
  get name of every anchor
end tell</code></pre> <p>the items in active pane</p> <pre><code>tell application "System Preferences"
    activate
    reveal pane id "com.apple.preference.general"
end tell
tell application "System Events"
    tell application process "System Preferences"
        repeat while not (window 1 exists)
        end repeat
        tell window "General"
            every UI element
        end tell
    end tell
end tell</code></pre> <h3 id=lets-make-some-scripts>let's make some scripts</h3> <p>You could choose default browser, and input sources with this.</p> <p><a href=https://github.com/ryuta69/dotfiles/tree/master/system/lib>https://github.com/ryuta69/dotfiles/tree/master/system/lib</a></p> <p>GUI settings and third party applications are now able to automate, I now finally can say I automate everything on MacOS.</p> <h2 id=summary>summary</h2> <p>I'm now confident with this script. I searched every other's script allday and everyday, and enhance myown for two month.</p> <p>Now I can use script editor, and select domains to search with it, but at first time there is no document, so I was struggling with a few informations and about core settings which is really hard to find. But those times are kind of fun and I really got enthusiatic about it.</p> <p>After all, I found myself really is a kind of person who is motivated with <strong>effective production</strong>. I used to speedrun gamers, and that time is like I didn't sleep, eat or talk with anyone. I got really absorbed in it and make script with it and find a bug to make breakthrough.....all for making time short, not dependence on people(make rule and reproductive), and beautiful to be proud. Now, I'm programmer and doing kind of similar thing.</p> <p>It's like studying others deeply, forget anything but itself, not sleeping nore eating, think how to appeal myself and beautiful, and make it reproductive and limit of effective to say this is perfect.</p> </div> <div class=meta><p class=date>2020-03-09</div></main> <footer><p><a href=blog>blog</a> <button class=focus:outline-none>want dark theme? </button></footer></div> 